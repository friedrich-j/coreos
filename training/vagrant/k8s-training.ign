{"ignition":{"version":"2.0.0","config":{}},"storage":{"files":[{"filesystem":"root","path":"/etc/hostname","contents":{"source":"data:,k8s-training","verification":{}},"mode":272,"user":{},"group":{}},{"filesystem":"root","path":"/home/core/.bashrc","contents":{"source":"data:,.%20%2Fusr%2Fshare%2Fskel%2F.bashrc%0Aalias%20ll%3D%22ls%20-l%22%0A","verification":{}},"mode":420,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/create-network-environment.sh","contents":{"source":"data:,%23!%2Fbin%2Fsh%0A.%20%20%2Fopt%2Fbin%2Finstall%2Ffunctions.inc%0Aif%3D%60ls%20-l%20%2Fsys%2Fclass%2Fnet%20%7C%20grep%20%22%2F0000%3A%5C%60lspci%20-m%20%7C%20awk%20'%2F%22Ethernet%20controller%2F%20%7B%20print%20%241%3B%20exit%200%20%7D'%5C%60%2F%22%20%7C%20awk%20'match(%240%2C%20%2F%5B%5E%20%5D*%20-%3E%2F)%20%7B%20print%20substr(%240%2CRSTART%2CRLENGTH-3)%20%7D'%60%0Abroadcast%20%22First%20network%20interface%20%24if%22%0Auntil%20ip%20a%20show%20%24if%20up%3B%20do%20sleep%202%3B%20done%0A%23until%20ping%20-c1%20www.github.com%3B%20do%20sleep%202%3B%20done%0Aifconfig%20%24if%20%7C%20awk%20'BEGIN%7Bn%3D0%7D%20match(%240%2C%20%2F%5E(%5Ba-zA-Z0-9%5D%2B)%3A%2F%2C%20a)%20%7B%20i%3Da%5B1%5D%3B%20e%3Dmatch(%240%2C%20%2FRUNNING%2F)%3B%20n%3Dn%2B1%20%7D%20match(%240%2C%20%2F%5E%20%2Binet%20(%5B0-9.%5D%2B)%2F%2C%20a)%20%7B%20ip%3Da%5B1%5D%3B%20if(n%3D%3D1)%20%7B%20print%20%22DEFAULT_IPV4%3D%22%20ip%20%7D%3B%20print%20toupper(i)%20%22_IPV4%3D%22%20ip%20%7D'%20%3E%20%2Fetc%2Fnetwork-environment%0Aif%20!%20ping%20-c1%20www.github.com%0Athen%0A%20%20%20%20for%20i%20in%20%60ip%20route%20%7C%20awk%20-v%20n%3D%24if%20'%2F%5Edefault%20via%20%2F%20%26%26%20%245!%3Dn%20%7B%20print%20%245%20%7D'%60%0A%20%20%20%20do%0A%20%20%20%20%20%20%20%20j%3D%60ip%20route%20%7C%20awk%20-v%20n%3D%24i%20'%2F%5Edefault%20via%20%2F%20%26%26%20%245%3D%3Dn%20%7B%20print%20%243%20%7D'%60%0A%20%20%20%20%20%20%20%20broadcast%20%22Removing%20default%20gateway%20for%20%24i%22%0A%20%20%20%20%20%20%20%20route%20del%20default%20gw%20%24j%0A%20%20%20%20done%0Afi%0Aif%20ping%20-c1%20www.github.com%0Athen%0A%20%20%20%20broadcast%20%22Network%20connected%20to%20Internet.%22%0Aelse%0A%20%20%20%20broadcast%20%22ERROR%3A%20Network%20not%20connected%20to%20Internet.%22%0Afi%0A","verification":{}},"mode":448,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/install/install_docker-compose.sh","contents":{"source":"data:,%23!%2Fbin%2Fsh%0A.%20%20%2Fopt%2Fbin%2Finstall%2Ffunctions.inc%0Auntil%20ping%20-c1%20api.github.com%3B%20do%20sleep%202%3B%20done%0Acurl%20-L%20%60curl%20-s%20https%3A%2F%2Fapi.github.com%2Frepos%2Fdocker%2Fcompose%2Freleases%2Flatest%20%7C%20jq%20-r%20'.assets%5B%5D.browser_download_url%20%7C%20select(contains(%22Linux%22)%20and%20contains(%22x86_64%22))'%60%20%3E%20%2Fopt%2Fbin%2Fdocker-compose%0Achmod%20%2Bx%20%2Fopt%2Fbin%2Fdocker-compose%0Abroadcast%20%22Installation%20of%20docker-compose%20finished.%22%0A","verification":{}},"mode":448,"user":{},"group":{}},{"filesystem":"root","path":"/etc/systemd/network/20-dhcp.network","contents":{"source":"data:,%5BMatch%5D%0AName%3Den*%0A%0A%5BNetwork%5D%0ADHCP%3Dyes%0A%0A%5BDHCP%5D%0AUseMTU%3Dtrue%0AUseDomains%3Dtrue%0AClientIdentifier%3Dmac%20%20%20%0A","verification":{}},"mode":420,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/install/functions.inc","contents":{"source":"data:,RED%3D'%5C033%5B0%3B31m'%0AGREEN%3D'%5C033%5B0%3B32m'%0AYELLOW%3D'%5C033%5B1%3B33m'%0ANC%3D'%5C033%5B0m'%20%23%20No%20Color%0A%0Afunction%20broadcast%0A%7B%0A%20%20%20%20printf%20%22%5Cn%24%7BYELLOW%7D%60basename%20%5C%22%240%5C%22%20.sh%60%20-%20%60date%20'%2B%25H%3A%25M%3A%25S'%60%3A%20%241%24%7BNC%7D%5Cn%22%20%3E%20%2Fdev%2Ftty1%0A%20%20%20%20for%20i%20in%20%60w%20%7C%20awk%20'BEGIN%7Bi%3D0%7D%20i%3E0%20%26%26%20%241%20%3D%3D%20%22core%22%20%7B%20print%20%242%20%7D%20%20%7B%20i%2B%2B%20%7D'%60%0A%20%20%20%20do%0A%20%20%20%20%20%20%20%20printf%20%22%5Cn%24%7BYELLOW%7D%60basename%20%5C%22%240%5C%22%20.sh%60%20-%20%60date%20'%2B%25H%3A%25M%3A%25S'%60%3A%20%241%24%7BNC%7D%5Cn%22%20%3E%20%2Fdev%2F%24i%0A%20%20%20%20done%0A%7D%0A","verification":{}},"mode":448,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/install/install_k8s.sh","contents":{"source":"data:,%23!%2Fbin%2Fsh%0A.%20%20%2Fopt%2Fbin%2Finstall%2Ffunctions.inc%0A%0Abroadcast%20%22Downloading%20kubernetes%20CNI%20...%22%0A%23%20CNI_VERSION%3D%22v0.6.0%22%0ACNI_VERSION%3D%22v0.7.1%22%0Amkdir%20-p%20%2Fopt%2Fcni%2Fbin%0Acurl%20-L%20%22https%3A%2F%2Fgithub.com%2Fcontainernetworking%2Fplugins%2Freleases%2Fdownload%2F%24%7BCNI_VERSION%7D%2Fcni-plugins-amd64-%24%7BCNI_VERSION%7D.tgz%22%20%7C%20tar%20-C%20%2Fopt%2Fcni%2Fbin%20-xz%0A%0Abroadcast%20%22Downloading%20kubernetes%20CRI%20...%22%0ACRICTL_VERSION%3D%22v1.11.1%22%0Amkdir%20-p%20%2Fopt%2Fbin%0Acurl%20-L%20%22https%3A%2F%2Fgithub.com%2Fkubernetes-incubator%2Fcri-tools%2Freleases%2Fdownload%2F%24%7BCRICTL_VERSION%7D%2Fcrictl-%24%7BCRICTL_VERSION%7D-linux-amd64.tar.gz%22%20%7C%20tar%20-C%20%2Fopt%2Fbin%20-xz%0A%0ARELEASE%3D%22%24(curl%20-sSL%20https%3A%2F%2Fdl.k8s.io%2Frelease%2Fstable.txt)%22%0A%0Abroadcast%20%22Downloading%20kubeadm%2C%20kubelet%2C%20kubectl%20...%22%0Amkdir%20-p%20%2Fopt%2Fbin%0Acd%20%2Fopt%2Fbin%0Acurl%20-L%20--remote-name-all%20https%3A%2F%2Fstorage.googleapis.com%2Fkubernetes-release%2Frelease%2F%24%7BRELEASE%7D%2Fbin%2Flinux%2Famd64%2F%7Bkubeadm%2Ckubelet%2Ckubectl%7D%0Achmod%20%2Bx%20%7Bkubeadm%2Ckubelet%2Ckubectl%7D%0A%0Abroadcast%20%22Setting%20up%20kubernetes%20services%20...%22%0Acurl%20-sSL%20%22https%3A%2F%2Fraw.githubusercontent.com%2Fkubernetes%2Fkubernetes%2F%24%7BRELEASE%7D%2Fbuild%2Fdebs%2Fkubelet.service%22%20%7C%20sed%20%22s%3A%2Fusr%2Fbin%3A%2Fopt%2Fbin%3Ag%22%20%3E%20%2Fetc%2Fsystemd%2Fsystem%2Fkubelet.service%0Amkdir%20-p%20%2Fetc%2Fsystemd%2Fsystem%2Fkubelet.service.d%0Acurl%20-sSL%20%22https%3A%2F%2Fraw.githubusercontent.com%2Fkubernetes%2Fkubernetes%2F%24%7BRELEASE%7D%2Fbuild%2Fdebs%2F10-kubeadm.conf%22%20%7C%20sed%20%22s%3A%2Fusr%2Fbin%3A%2Fopt%2Fbin%3Ag%22%20%3E%20%2Fetc%2Fsystemd%2Fsystem%2Fkubelet.service.d%2F10-kubeadm.conf%0Asystemctl%20enable%20kubelet%20%26%26%20systemctl%20start%20kubelet%20%0A%0Abroadcast%20%22Pulling%20kubernetes%20images%20...%22%0Akubeadm%20config%20images%20pull%0A%0Abroadcast%20%22Installation%20of%20kubernetes%20software%20finished.%22%0A","verification":{}},"mode":448,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/install/set_k8s_config.sh","contents":{"source":"data:,%23!%2Fbin%2Fsh%0A.%20%20%2Fopt%2Fbin%2Finstall%2Ffunctions.inc%0A%0Amkdir%20-p%20%2Fhome%2Fcore%2F.kube%0Acp%20-i%20%2Fetc%2Fkubernetes%2Fadmin.conf%20%2Fhome%2Fcore%2F.kube%2Fconfig%0Achown%20-R%20core%3Acore%20%2Fhome%2Fcore%2F.kube%0Abroadcast%20%22Setup%20of%20user-specific%20config%20finished.%22%0A","verification":{}},"mode":448,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/install/install_k8s_master.sh","contents":{"source":"data:,%23!%2Fbin%2Fsh%0A.%20%20%2Fopt%2Fbin%2Finstall%2Ffunctions.inc%0A%0Aexport%20PATH%3D%24PATH%3A%2Fopt%2Fbin%0A%0A%2Fopt%2Fbin%2Finstall%2Finstall_k8s.sh%0A%0Aips%3D%60ifconfig%20%7C%20awk%20'match(%240%2C%20%2F%5E%5B%5E%20%3A%5D%2B%2F)%20%7B%20n%3Dsubstr(%240%2C%20RSTART%2C%20RLENGTH)%20%7D%20match(%240%2C%20%2F%20%2Binet%20%5B0-9.%5D%2B%2F)%20%7B%20ip%3Dsubstr(%240%2C%20RSTART%2C%20RLENGTH)%3B%20gsub(%2F%5E%20%2Binet%20%2B%2F%2C%20%22%22%2C%20ip)%3B%20if%20(!match(n%2C%20%2Fcni%7Cdocker%7Cflannel%7Clo%2F))%20%7B%20if(i%3E0)%20%7B%20printf%20%22%2C%25s%22%2C%20ip%20%7D%20else%20%7B%20printf%20%22%25s%22%2C%20ip%20%7D%3B%20i%3Di%2B1%20%7D%20%20%7D'%60%0A%0Akubeadm%20init%20--pod-network-cidr%3D10.244.0.0%2F16%20--ignore-preflight-errors%3DNumCPU%20--apiserver-cert-extra-sans%3D%22%24ips%22%20%202%3E%261%20%7C%20tee%20%2Fopt%2Fbin%2Finstall%2Fk8s_join.txt%0Abroadcast%20%22Initialization%20of%20kubernetes%20master%20finished.%22%0A%0A%2Fopt%2Fbin%2Finstall%2Fset_k8s_config.sh%0A%0Asudo%20-i%20-u%20core%20kubectl%20apply%20-f%20https%3A%2F%2Fraw.githubusercontent.com%2Fcoreos%2Fflannel%2Fmaster%2FDocumentation%2Fkube-flannel.yml%0Abroadcast%20%22Setup%20of%20flannel%20finished.%22%0A%0Asudo%20-i%20-u%20core%20kubectl%20taint%20nodes%20--all%20node-role.kubernetes.io%2Fmaster-%0A%0A%23%20sudo%20-i%20-u%20core%20kubectl%20create%20-f%20%20https%3A%2F%2Fk8s.io%2Fexamples%2Fcontrollers%2Fnginx-deployment.yaml%20%20%20%20%20%20%20%0A%0Abroadcast%20%22Installation%20of%20kubernetes%20master%20finished.%22%0A%0Atouch%20%2Fopt%2Fbin%2Finstall%2Fready.txt%0Abroadcast%20%22Have%20fun!%22%0A","verification":{}},"mode":448,"user":{},"group":{}},{"filesystem":"root","path":"/opt/bin/install/install_k8s_worker.sh","contents":{"source":"data:,%23!%2Fbin%2Fsh%0A.%20%20%2Fopt%2Fbin%2Finstall%2Ffunctions.inc%0A%2Fopt%2Fbin%2Finstall%2Finstall_k8s.sh%0Abroadcast%20%22Please%20to%20following%20actions%3A%5Cn-%20join%20this%20kubernetes%20worker%20to%20the%20kubernetes%20cluster%5Cn-%20configure%20local%20kubernetes%20config%5Cn%5CnHave%20fun!%22%0A","verification":{}},"mode":448,"user":{},"group":{}},{"filesystem":"root","path":"/etc/coreos/update.conf","contents":{"source":"data:,%0AREBOOT_STRATEGY%3D%22off%22","verification":{}},"mode":420,"user":{},"group":{}}]},"systemd":{"units":[{"name":"update-engine.service","mask":true},{"name":"locksmithd.service","mask":true},{"name":"internet-connected.service","enable":true,"contents":"[Unit]\nDescription=Creates an network environment file\nDocumentation=https://github.com/Cube-Earth/container-tools-coreos-setup-iso\nRequires=network-online.target\nAfter=network-online.target\n  \n[Service]\nType=oneshot\nRemainAfterExit=true\nExecStart=/opt/bin/create-network-environment.sh\n      \n[Install]\nWantedBy=multi-user.target\n"},{"name":"install_docker-compose.service","enable":true,"contents":"[Unit]\nConditionFirstBoot=yes\nDescription=Installs docker-compose\nRequires=internet-connected.service\nAfter=internet-connected.service\n\n[Service]\nType=oneshot\nRemainAfterExit=true\nExecStart=/opt/bin/install/install_docker-compose.sh\n    \n[Install]\nWantedBy=multi-user.target\n"},{"name":"docker.service","enable":true,"dropins":[{"name":"60-docker-wait-internet.conf","contents":"[Unit]\nAfter=internet-connected.service\nRequires=internet-connected.service\n\n[Service]\nRestart=always\n"}]},{"name":"install_kubernetes.service","enable":true,"contents":"[Unit]\nConditionFirstBoot=yes\nDescription=Installs Kubernetes\nRequires=docker.service\nAfter=docker.service\n\n[Service]\nType=oneshot\nRemainAfterExit=true\nExecStart=/opt/bin/install/install_k8s_master.sh \u003e /opt/bin/install/install_k8s_master.log\n    \n[Install]\nWantedBy=multi-user.target\n"}]},"networkd":{},"passwd":{"users":[{"name":"core","sshAuthorizedKeys":["ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDJSbOpP3+8rtyoyaXjo+DQkSFpF4T7Q23zpTeCENVymPW7slPUTSOIvy2mmDJa0fwvI+SeDpnxL87/iiyZnLZLKRliVnCUs8iISp9aDrYigcyZc4AGA1c3BWm5DooH7oABvwtsrEPv5zpBTWwIybDA86PmV0hoMxgGsVMUdcxLkoVEkZqanjrcB1ntR2ILLH3U/s1+M6NdUWqyF0ga0WGLlcs/wMi4BgNqcGLOx+hGjtUu45Bq3Tr0waM1n4MCsf4HPntsgzBiFDfWzNmcR0gV4vIVb0graWoCoh695jjrRwJXsBNMU0Kjj6b8h+Y/vU19walDMnmDInpRgRSbBBxZzKvyTCKUvwq2LWKhfaGHa9lskJgD9umZTS7TuppRlSlxtcKX47XnVQ+BEC2mD9LGNEhljJbOTsThemL89bTcNxCS6EMtF7UqaZLvHUXW0g2jxIEh9ovOSce/syEFw7lEmVD8NpJmR/jkAAbSYb6uZdj/xX85Uifh0JlqNiU+DgKhjpKN8M+C4gHDEqiS7km2SFDrmhz58VLkmwJXGT9RNyq8b7D48YUmvZDpMxiO3O1Ewg4HjetuvhYlHmgcpE5WvDn9WKC8onEjPosaNT5yQiOeuX0Nh0PlgcdLLb/KtBK3Hzx9BRmrCDMK00/tJkFVQm2IrZ/aEW+Te1xVeNDxnQ== joerg@matrix"]}]}}